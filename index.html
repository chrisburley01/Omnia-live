<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Omnia ‚Äî One App for Everything</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0b0f1a"/>

<!-- Icons for PWA (optional if you have them) -->
<link rel="icon" href="icons/icon-192.png" sizes="192x192" />
<link rel="icon" href="icons/icon-512.png" sizes="512x512" />
<link rel="apple-touch-icon" href="icons/icon-180.png" />
<link rel="mask-icon" href="icons/icon-maskable.png" color="#0b0f1a" />

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root { --om1:#7C9EFF; --om2:#22D3EE; }
  body{
    background:radial-gradient(60rem 40rem at 20% -10%,#1e293b,#020617 60%),#020617;
    color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif
  }
  .glass{background:rgba(255,255,255,.06);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1)}
  .btn{background:linear-gradient(90deg,#60a5fa,#6366f1);border-radius:.75rem;padding:.75rem 1rem}
  .pill{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:.75rem;padding:.25rem .5rem;font-size:.7rem}
  .tap{transition:transform .08s ease} .tap:active{transform:scale(.98)}
  .ripple{position:relative;overflow:hidden}
  .ripple:after{content:"";position:absolute;inset:auto 50% 50% auto;width:0;height:0;border-radius:999px;background:rgba(255,255,255,.25);transform:translate(-50%,-50%);opacity:0;pointer-events:none}
  .ripple:active:after{width:160px;height:160px;opacity:1;transition:width .25s ease,height .25s ease,opacity .6s ease}

  /* Icon frame */
  .iconWrap{
    width:56px;height:56px;border-radius:16px;display:grid;place-items:center;
    background:
      radial-gradient(120% 120% at 0% 0%, rgba(124,158,255,.35), transparent 60%),
      radial-gradient(120% 120% at 100% 100%, rgba(14,165,233,.35), transparent 60%),
      rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.15);
    box-shadow: inset 0 10px 25px rgba(0,0,0,.25), 0 0 32px rgba(124,158,255,.25);
  }
  .icon{width:26px;height:26px}

  /* Tiles */
  .tile { position: relative; display:block; opacity:0; transform:translateY(8px); }
  .tileInner {
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1);
    border-radius:1rem; padding:1rem; width:100%; height:100%;
    transition: transform .12s ease, background .15s ease, border-color .15s ease;
    display:grid; grid-template-rows:auto auto auto; justify-items:center; text-align:center;
  }
  .tile h4 { margin-top:.6rem; font-weight:600 }
  .tile p  { font-size:.8rem; color:#cbd5e1 }
  .tile:hover .tileInner{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.18); transform:translateY(-2px) }
  .tile.appear { animation: tileIn .45s cubic-bezier(.2,.8,.2,1) forwards }
  @keyframes tileIn { to { opacity:1; transform:translateY(0) } }

  /* Badges */
  .badge { position:absolute; top:10px; right:10px; padding:2px 7px; font-size:.7rem; line-height:1;
    border-radius:999px; background:linear-gradient(90deg,#60a5fa,#22d3ee); color:#0b1220; font-weight:700;
    border:1px solid rgba(255,255,255,.25); }

  /* Image fallbacks (search) */
  .imgCard{position:relative;overflow:hidden}
  .imgCard img{width:100%;height:100%;object-fit:cover;display:block}
  .imgPh{display:grid;place-items:center;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:#a5b4fc}

  /* Toast */
  #toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);
    background:rgba(20,24,38,.95);color:#fff;border:1px solid rgba(255,255,255,.1);
    padding:.6rem .9rem;border-radius:.75rem;z-index:60;display:none}
</style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="glass sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <button id="logoBtn" class="flex items-center gap-2 cursor-pointer tap ripple" aria-label="Reset Omnia">
        <!-- Inline SVG LOGO -->
        <svg width="40" height="40" viewBox="0 0 64 64" class="rounded-lg">
          <defs>
            <linearGradient id="lg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/>
            </linearGradient>
          </defs>
          <rect x="4" y="4" width="56" height="56" rx="14" fill="#0b1220" stroke="url(#lg)" stroke-width="2"/>
          <path d="M20 42c0-8 6-14 14-14s14 6 14 14" stroke="url(#lg)" stroke-width="3" fill="none" stroke-linecap="round"/>
          <circle cx="26" cy="26" r="4" fill="url(#lg)"/>
        </svg>
        <div class="leading-tight text-left">
          <h1 class="text-xl font-bold">Omnia</h1>
          <p class="text-xs text-gray-300">Ask anything. Omnia gets it done.</p>
        </div>
      </button>
      <div class="flex-1"></div>
      <div class="hidden sm:flex gap-2 mr-2">
        <span class="pill">Private</span><span class="pill">Unified ID</span><span class="pill">OmniPay</span><span class="pill">v11</span>
      </div>
      <button id="shareBtn" class="glass w-9 h-9 rounded-lg grid place-items-center tap ripple" aria-label="Share Omnia" title="Share">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <defs><linearGradient id="share-grad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
          <circle cx="18" cy="5" r="3" stroke="url(#share-grad)" stroke-width="1.8"/>
          <circle cx="6" cy="12" r="3" stroke="url(#share-grad)" stroke-width="1.8"/>
          <circle cx="18" cy="19" r="3" stroke="url(#share-grad)" stroke-width="1.8"/>
          <path d="M8.7 10.9l6-3.4M8.7 13.1l6 3.4" stroke="url(#share-grad)" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
      <button id="installBtn" class="ml-2 px-3 py-1 bg-blue-500 rounded-lg text-sm hidden">Install</button>
    </div>
  </header>

  <!-- Search -->
  <main class="flex-1 w-full">
    <section class="max-w-3xl mx-auto w-full px-4 pt-6">
      <div class="flex gap-2 mb-4">
        <input id="query" type="text" aria-label="Ask Omnia"
          placeholder="Ask Omnia anything‚Ä¶  (e.g., pay @ari 20 ‚Ä¢ ride to Heathrow at 8pm ‚Ä¢ order oat milk)"
          class="flex-1 px-4 py-3 rounded-xl text-black" />
        <button id="askBtn" class="btn tap ripple" aria-label="Ask">Ask</button>
      </div>
      <div id="results" class="space-y-4 text-sm text-gray-300">
        <div class="glass p-4 rounded-xl">Tip: press <b>/</b> to focus search. Try ‚Äúbest espresso beans‚Äù or ‚Äúweather Madrid‚Äù.</div>
      </div>
    </section>

    <!-- Modules -->
    <section class="max-w-6xl mx-auto px-4 py-8">
      <h3 class="text-sm uppercase tracking-wide text-gray-400 mb-3">Omnia Modules</h3>
      <div id="tileGrid" class="grid gap-3 grid-cols-2 md:grid-cols-3 lg:grid-cols-4">

        <!-- Payments -->
        <button data-open="pay" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <rect x="3" y="5" width="18" height="14" rx="3" stroke="url(#g1)" stroke-width="1.8"/>
                <rect x="6" y="10" width="12" height="1.8" rx="0.9" fill="url(#g1)"/>
              </svg>
            </div>
            <h4>Payments</h4><p>Send & request</p>
          </div>
        </button>

        <!-- Rides -->
        <button data-open="ride" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g2" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M5 12l2-4h10l2 4" stroke="url(#g2)" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M4 16h16" stroke="url(#g2)" stroke-width="1.8" stroke-linecap="round"/>
                <circle cx="7.5" cy="16" r="1.6" fill="url(#g2)"/><circle cx="16.5" cy="16" r="1.6" fill="url(#g2)"/>
              </svg>
            </div>
            <h4>Rides</h4><p>Book & track</p>
          </div>
        </button>

        <!-- Groceries -->
        <button data-open="order" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g3" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M6 6h14l-1.2 8.5a3 3 0 0 1-3 2.5H9.5a3 3 0 0 1-3-2.5L6 6z" stroke="url(#g3)" stroke-width="1.8"/>
                <path d="M9 6c0-1.7 1.3-3 3-3s3 1.3 3 3" stroke="url(#g3)" stroke-width="1.8"/>
              </svg>
            </div>
            <h4>Groceries</h4><p>Smart list</p>
          </div>
        </button>

        <!-- Calendar -->
        <button data-open="calendar" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g4" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <rect x="4" y="5" width="16" height="14" rx="2" stroke="url(#g4)" stroke-width="1.8"/>
                <path d="M4 9h16" stroke="url(#g4)" stroke-width="1.8"/>
                <rect x="8" y="12" width="3" height="3" rx="0.8" fill="url(#g4)"/>
              </svg>
            </div>
            <h4>Calendar</h4><p>Agenda & reminders</p>
          </div>
        </button>

        <!-- Messages -->
        <button data-open="messages" class="tile tap ripple">
          <span class="badge" id="badge-messages">2</span>
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g5" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M5 6h14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9l-4 3v-3H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z" stroke="url(#g5)" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M7 10h10" stroke="url(#g5)" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
            </div>
            <h4>Messages</h4><p>Unified inbox</p>
          </div>
        </button>

        <!-- Media -->
        <button data-open="media" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g6" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <circle cx="12" cy="12" r="8" stroke="url(#g6)" stroke-width="1.8"/>
                <path d="M10 9l6 3-6 3V9z" fill="url(#g6)"/>
              </svg>
            </div>
            <h4>Media</h4><p>Music & video</p>
          </div>
        </button>

        <!-- Health -->
        <button data-open="health" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g7" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M5 12c0-2.8 2.2-5 5-5 1.4 0 2.7.6 3.6 1.6A5 5 0 0 1 22 12c0 4.5-6.7 7-10 10-3.3-3-10-5.5-10-10z" stroke="url(#g7)" stroke-width="1.8" stroke-linejoin="round"/>
              </svg>
            </div>
            <h4>Health</h4><p>Snapshot & goals</p>
          </div>
        </button>

        <!-- Smart Home -->
        <button data-open="smarthome" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g8" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M4 10l8-6 8 6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8z" stroke="url(#g8)" stroke-width="1.8" stroke-linejoin="round"/>
                <rect x="10" y="13" width="4" height="5" rx="1" stroke="url(#g8)" stroke-width="1.8"/>
              </svg>
            </div>
            <h4>Smart Home</h4><p>Lights & devices</p>
          </div>
        </button>

        <!-- Bookings -->
        <button data-open="bookings" class="tile tap ripple">
          <span class="badge" id="badge-bookings">New</span>
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g9" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M3 13l18-6-6 18-3-7-7-5z" stroke="url(#g9)" stroke-width="1.8" stroke-linejoin="round"/>
              </svg>
            </div>
            <h4>Bookings</h4><p>Flights & hotels</p>
          </div>
        </button>

        <!-- Maps -->
        <button data-open="maps" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g10" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M12 22s7-6.5 7-12a7 7 0 1 0-14 0c0 5.5 7 12 7 12z" stroke="url(#g10)" stroke-width="1.8"/>
                <circle cx="12" cy="10" r="2" fill="url(#g10)"/>
              </svg>
            </div>
            <h4>Maps</h4><p>Navigate</p>
          </div>
        </button>

        <!-- ID -->
        <button data-open="id" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g11" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <rect x="4" y="6" width="16" height="12" rx="2" stroke="url(#g11)" stroke-width="1.8"/>
                <circle cx="9" cy="12" r="2" stroke="url(#g11)" stroke-width="1.6"/>
                <rect x="12.5" y="11" width="5" height="2" rx="1" fill="url(#g11)"/>
              </svg>
            </div>
            <h4>ID & Passes</h4><p>Wallet</p>
          </div>
        </button>

        <!-- Files -->
        <button data-open="files" class="tile tap ripple">
          <div class="tileInner">
            <div class="iconWrap">
              <svg class="icon" viewBox="0 0 24 24" fill="none">
                <defs><linearGradient id="g12" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
                <path d="M4 7a2 2 0 0 1 2-2h5l3 3h4a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7z" stroke="url(#g12)" stroke-width="1.8" stroke-linejoin="round"/>
              </svg>
            </div>
            <h4>Files</h4><p>Docs & notes</p>
          </div>
        </button>

      </div>
    </section>
  </main>

  <!-- Bottom Sheet -->
  <div id="sheet" class="hidden fixed inset-0 z-50 bg-black/60 grid place-items-end">
    <div class="w-full max-w-xl bg-slate-900 border-t border-white/10 p-4 rounded-t-2xl">
      <div id="sheetBody"></div>
      <button id="closeSheet" class="w-full mt-4 h-11 glass rounded-xl">Close</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite">Link copied</div>

  <!-- Footer -->
  <footer class="text-center text-xs text-gray-500 py-6">
    ¬© 2025 Omnia. One app. Every part of your life.
  </footer>

<script>
  /* ===== Omnia v11 ===== */
  const OMNIA_API = "https://ommia-search.chrisburley01.workers.dev";
  const $ = (s, r=document) => r.querySelector(s);

  /* Share */
  const toast = $("#toast");
  function showToast(msg="Copied!") {
    toast.textContent = msg; toast.style.display = "block";
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=> toast.style.display="none", 1800);
  }
  $("#shareBtn")?.addEventListener("click", async () => {
    const data = { title: "Omnia ‚Äî One app for everything", text: "Try Omnia. Ask anything, get it done.", url: location.href };
    try { if (navigator.share) await navigator.share(data); else { await navigator.clipboard.writeText(location.href); showToast("Link copied"); } }
    catch { try { await navigator.clipboard.writeText(location.href); showToast("Link copied"); } catch {} }
  });

  /* Logo reset */
  $("#logoBtn")?.addEventListener("click", () => {
    const q = $("#query"); const res = $("#results");
    if (q) q.value = "";
    if (res) res.innerHTML = `<div class="glass p-4 rounded-xl">Tip: press <b>/</b> to focus search. Try ‚Äúbest espresso beans‚Äù or ‚Äúweather Madrid‚Äù.</div>`;
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  /* Search */
  const qEl = $("#query"), askBtn = $("#askBtn"), results = $("#results");
  askBtn?.addEventListener("click", runSearch);
  qEl?.addEventListener("keydown", e => { if (e.key === "Enter") { e.preventDefault(); runSearch(); } });
  window.addEventListener("keydown", e => { if (e.key === "/" && document.activeElement !== qEl) { e.preventDefault(); qEl?.focus(); } });

  function normalizeImgUrl(u){
    if (!u) return "";
    try {
      if (u.startsWith("//")) return "https:" + u;
      if (/^https?:|^data:/.test(u)) return u;
      return new URL(u, "https://").href;
    } catch { return ""; }
  }
  function placeholderNode(alt="Image"){
    const wrap = document.createElement("div");
    wrap.className = "imgPh rounded-xl w-full h-40";
    wrap.innerHTML = `<div class="text-xs flex items-center gap-2">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <defs><linearGradient id="ph" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#7C9EFF"/><stop offset="100%" stop-color="#22D3EE"/></linearGradient></defs>
          <circle cx="12" cy="12" r="9" stroke="url(#ph)" stroke-width="1.6"/>
          <path d="M10 9l6 3-6 3V9z" fill="url(#ph)"/>
        </svg><span class="opacity-80">Omnia</span></div>`;
    wrap.setAttribute("aria-label", alt); return wrap;
  }
  function renderImages(arr){
    if (!arr?.length) return "";
    const container = document.createElement("div"); container.className = "grid grid-cols-2 sm:grid-cols-3 gap-2";
    arr.forEach(img=>{
      const cell = document.createElement("div"); cell.className = "imgCard rounded-xl w-full h-40";
      const src = normalizeImgUrl(img.src || img.url);
      if (!src){ cell.replaceChildren(placeholderNode(img.alt||"Image")); }
      else {
        const el = document.createElement("img");
        el.loading = "lazy"; el.alt = img.alt || "Image result"; el.referrerPolicy = "no-referrer"; el.crossOrigin = "anonymous";
        el.src = src; el.onerror = () => cell.replaceChildren(placeholderNode(el.alt));
        cell.appendChild(el);
      }
      container.appendChild(cell);
    });
    return container.outerHTML;
  }

  async function runSearch() {
    const q = qEl.value.trim(); if (!q) return;
    results.innerHTML = `<div class="glass p-4 rounded-xl">Searching for ‚Äú${q}‚Äù‚Ä¶</div>`;
    try {
      const res = await fetch(`${OMNIA_API}/search?q=${encodeURIComponent(q)}`);
      if (!res.ok) throw new Error("API error");
      const data = await res.json();

      const seen = new Set(), src = [];
      const addSrc = (u)=>{ try{ const h=new URL(u).hostname.replace(/^www\./,''); if(!seen.has(h)){ seen.add(h); src.push({h,url:u}); } }catch{} };
      (data.links||[]).forEach(l=>addSrc(l.url)); (data.wiki||[]).forEach(w=>addSrc(w.url));
      const sourcesRow = src.length ? `<div class="mt-2 text-xs text-gray-400">Sources: ${src.slice(0,5).map(s=>`<a href="${s.url}" target="_blank" class="underline hover:opacity-80">${s.h}</a>`).join(' ¬∑ ')}</div>` : "";

      let html = "";
      if (data.summary || data.abstract) {
        html += `<div class="glass p-4 rounded-xl">
          <div class="text-sm uppercase text-gray-400 mb-2">Omnia Answer</div>
          <div class="prose prose-invert max-w-none">${(data.summary || data.abstract).replace(/\n/g, "<br>")}</div>
          ${sourcesRow}
        </div>`;
      }
      if (data.wiki?.length) {
        html += `<div><div class="text-sm uppercase text-gray-400 mb-2">From Wikipedia</div>
          <div class="grid gap-3">
            ${data.wiki.map(p=>`
              <a href="${p.url}" target="_blank" class="glass p-3 rounded-xl block hover:bg-white/5">
                <div class="flex gap-3">
                  ${p.thumb?`<img src="${normalizeImgUrl(p.thumb)}" class="w-12 h-12 rounded-lg object-cover" alt="">`:``}
                  <div><div class="font-semibold">${p.title}</div>
                    <div class="text-xs text-gray-400">${p.description||""}</div></div>
                </div>
              </a>`).join("")}
          </div></div>`;
      }
      if (data.links?.length) {
        html += `<div><div class="text-sm uppercase text-gray-400 mb-2">Top Results</div>
          <div class="grid gap-2">
            ${data.links.map(l=>`
              <a href="${l.url}" target="_blank" class="glass p-3 rounded-xl block hover:bg-white/5">
                <div class="font-medium">${l.title}</div>
                <div class="text-xs text-gray-400">${l.host}</div>
              </a>`).join("")}
          </div></div>`;
      }
      if (data.images?.length) {
        html += `<div><div class="text-sm uppercase text-gray-400 mb-2">Images</div>${renderImages(data.images)}</div>`;
      }
      results.innerHTML = html || `<div class="glass p-4 rounded-xl">No results found for ‚Äú${q}‚Äù.</div>`;
    } catch {
      results.innerHTML = `<div class="glass p-4 rounded-xl">Couldn‚Äôt reach Omnia API. Check Worker URL and try again.</div>`;
    }
  }

  /* Bottom Sheet + confirm */
  const sheet = document.getElementById("sheet");
  const sheetBody = document.getElementById("sheetBody");
  function openSheet(html){ sheetBody.innerHTML = html; sheet.classList.remove("hidden"); }
  function hideSheet(){ sheet.classList.add("hidden"); }
  function confirmClose(){ return confirm("Are you sure you want to close this? Any unsaved actions will be lost."); }
  function closeSheet({force=false}={}){ if (!force && !confirmClose()) return; hideSheet(); }
  document.getElementById("closeSheet")?.addEventListener("click", () => closeSheet({force:false}));
  sheet?.addEventListener("click", (e)=>{ if (e.target === sheet) closeSheet({force:false}); });

  /* Demo state */
  const contacts = JSON.parse(localStorage.getItem("omnia:contacts")||'["ari","bea","chen"]');
  const places = JSON.parse(localStorage.getItem("omnia:places")||'["Heathrow","Atocha Station"]');
  const list = JSON.parse(localStorage.getItem("omnia:list")||'["Oat milk","Eggs","Espresso pods"]');

  /* Module sheets */
  function sheetPay(preset={}){ openSheet(`
    <h3 class="text-lg font-semibold">Send money</h3>
    <p class="text-sm text-gray-300 mb-3">OmniPay secure transfer</p>
    <label class="text-xs text-gray-400">Recipient</label>
    <input id="payTo" class="w-full h-11 rounded-lg bg-white/10 px-3 mb-3 text-white" placeholder="@username" value="${preset.to||contacts[0]}">
    <label class="text-xs text-gray-400">Amount</label>
    <input id="payAmt" type="number" min="1" step="0.01" class="w-full h-11 rounded-lg bg-white/10 px-3 mb-3 text-white" value="${preset.amount||20}">
    <label class="text-xs text-gray-400">Note</label>
    <input id="payNote" class="w-full h-11 rounded-lg bg-white/10 px-3 text-white" placeholder="What‚Äôs this for?" value="${preset.note||''}">
    <div class="flex gap-2 mt-4">
      <button id="sendNow" class="flex-1 h-11 btn tap ripple">Send</button>
      <a id="sendPaypal" class="flex-1 h-11 glass rounded-xl grid place-items-center tap ripple" target="_blank">PayPal</a>
    </div>`);}
  function sheetRide(plan={}){ openSheet(`
    <h3 class="text-lg font-semibold">Ride options</h3>
    <p class="text-sm text-gray-300 mb-3">Destination: <b>${plan.where||places[0]}</b> ‚Ä¢ When: <b>${plan.when||'soon'}</b></p>
    <div class="grid gap-2">
      <a class="px-3 py-3 glass rounded-xl block tap ripple" target="_blank" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(plan.where||places[0])}">Open in Google Maps</a>
      <a class="px-3 py-3 glass rounded-xl block tap ripple" target="_blank" href="https://m.uber.com/ul/">Open Uber</a>
    </div>
    <button class="w-full mt-4 h-11 btn tap ripple" id="bookRide">Book best option</button>`);}
  function sheetOrder(item){ openSheet(`
    <h3 class="text-lg font-semibold">Confirm order</h3>
    <p class="text-sm text-gray-300">Groceries in ~25 minutes.</p>
    <ul class="list-disc ml-6 my-3 text-sm">
      ${[...list.slice(0,3), item ? `+ ${item}` : ""].filter(Boolean).map(x => `<li>${x}</li>`).join("")}
    </ul>
    <div class="grid gap-2">
      <a class="px-3 py-3 glass rounded-xl block tap ripple" target="_blank" href="https://www.amazon.co.uk/s?k=${encodeURIComponent(item||'oat milk eggs')}">Search Amazon</a>
      <a class="px-3 py-3 glass rounded-xl block tap ripple" target="_blank" href="https://www.google.com/search?q=${encodeURIComponent(item||'groceries near me')}">Search Google</a>
    </div>
    <button class="w-full mt-4 h-11 btn tap ripple" id="payOrder">Pay with OmniPay</button>`);}
  function sheetCalendar(){ openSheet(`
    <h3 class="text-lg font-semibold">Today</h3>
    <div class="mt-2 space-y-2 text-sm">
      <div class="flex items-center justify-between"><span>Client meeting</span><span>10:00</span></div>
      <div class="flex items-center justify-between"><span>Anniversary dinner</span><span>19:00</span></div>
      <div class="flex items-center justify-between"><span>Daily Planner AI</span><span>in 12 min</span></div>
    </div>`);}
  function sheetMessages(){ openSheet(`
    <h3 class="text-lg font-semibold">Messages</h3>
    <div class="mt-2 text-sm text-gray-300">Unified inbox coming soon. Reply, email, SMS in one place.</div>`); setBadge("messages", 0); }
  function sheetMedia(){ openSheet(`
    <h3 class="text-lg font-semibold">Evening wind‚Äëdown</h3>
    <div class="flex items-center gap-3 mt-2">
      <div class="w-12 h-12 rounded-lg bg-white/10 grid place-items-center">üéµ</div>
      <div class="flex-1"><div class="font-medium">Calm Focus</div><div class="text-sm text-gray-300">Lo‚Äëfi & ambient ¬∑ 45 min</div></div>
      <button class="h-10 px-3 btn tap ripple">Play</button>
    </div>`);}
  function sheetHealth(){ openSheet(`
    <h3 class="text-lg font-semibold">Health snapshot</h3>
    <div class="space-y-2 text-sm mt-2">
      <div class="flex items-center justify-between"><span>Steps</span><span>7,420</span></div>
      <div class="flex items-center justify-between"><span>Recovery</span><span>Good</span></div>
    </div>`);}
  function sheetSmartHome(){ openSheet(`
    <h3 class="text-lg font-semibold">Smart Home</h3>
    <div class="grid gap-2 mt-2">
      <button class="h-11 glass rounded-xl tap ripple">üü° Turn on living room lights</button>
      <button class="h-11 glass rounded-xl tap ripple">üîí Lock front door</button>
      <button class="h-11 glass rounded-xl tap ripple">üå°Ô∏è Set thermostat to 20¬∞C</button>
    </div>`);}
  function sheetBookings(){ openSheet(`
    <h3 class="text-lg font-semibold">Bookings</h3>
    <div class="text-sm text-gray-300 mt-2">Search flights, hotels, trains in one view (coming soon).</div>`); setBadge("bookings",""); }
  function sheetMaps(){ openSheet(`
    <h3 class="text-lg font-semibold">Maps</h3>
    <div class="mt-2"><a class="underline" target="_blank" href="https://maps.google.com">Open Maps</a></div>`);}
  function sheetID(){ openSheet(`
    <h3 class="text-lg font-semibold">ID & Passes</h3>
    <div class="text-sm text-gray-300 mt-2">Store ID, boarding passes, and tickets securely.</div>`);}
  function sheetFiles(){ openSheet(`
    <h3 class="text-lg font-semibold">Files</h3>
    <div class="text-sm text-gray-300 mt-2">Docs, notes, and shared links (coming soon).</div>`);}

  function setBadge(tile, value) {
    const el = document.getElementById(`badge-${tile}`);
    if (!el) return;
    if (value === 0 || value === "" || value == null) el.style.display = "none";
    else { el.textContent = value; el.style.display = "inline-block"; }
  }

  document.querySelectorAll(".tile,[data-open]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const m = btn.getAttribute("data-open");
      ({pay:sheetPay, ride:sheetRide, order:sheetOrder, calendar:sheetCalendar, messages:sheetMessages,
        media:sheetMedia, health:sheetHealth, smarthome:sheetSmartHome, bookings:sheetBookings,
        maps:sheetMaps, id:sheetID, files:sheetFiles}[m])?.();
    });
  });

  /* Appear animation */
  const tiles = Array.from(document.querySelectorAll('.tile'));
  const io = new IntersectionObserver((entries)=>{
    entries.forEach((e)=> {
      if (e.isIntersecting) {
        const idx = tiles.indexOf(e.target);
        e.target.style.animationDelay = `${(idx % 8) * 40}ms`;
        e.target.classList.add('appear');
        io.unobserve(e.target);
      }
    });
  }, { root: null, rootMargin: '0px 0px -10% 0px', threshold: 0.1 });
  tiles.forEach(t => io.observe(t));

  /* Sheet actions (bypass confirm on success) */
  sheet.addEventListener("click",(e)=>{
    if (e.target.id === "sendNow") {
      const to = document.getElementById("payTo").value.trim();
      const amt = parseFloat(document.getElementById("payAmt").value);
      if (!to) return alert("Enter recipient");
      if (!Number.isFinite(amt) || amt<=0) return alert("Enter valid amount");
      alert(`Sent ‚Ç¨${amt.toFixed(2)} to ${to}`);
      const clean = to.replace(/^@/,'');
      const contacts = JSON.parse(localStorage.getItem("omnia:contacts")||"[]");
      if (!contacts.includes(clean)) { contacts.unshift(clean); localStorage.setItem("omnia:contacts", JSON.stringify(contacts.slice(0,6))); }
      closeSheet({ force: true });
    }
    if (e.target.id === "payOrder") { alert("Order paid ‚Ä¢ ETA ~25 min"); closeSheet({ force: true }); }
    if (e.target.id === "bookRide") { alert("Ride booked ‚Ä¢ driver en route üöó"); closeSheet({ force: true }); }
    if (e.target.id === "sendPaypal") {
      const to = document.getElementById("payTo").value.trim().replace(/^@/,''); const amt = document.getElementById("payAmt").value;
      e.target.href = `https://www.paypal.com/paypalme/${encodeURIComponent(to||'')}/${encodeURIComponent(amt||'')}`;
    }
  });

  /* Install prompt */
  let deferredPrompt; const installBtn = document.getElementById("installBtn");
  window.addEventListener("beforeinstallprompt", e => { e.preventDefault(); deferredPrompt = e; installBtn?.classList.remove("hidden"); });
  installBtn?.addEventListener("click", async () => { installBtn?.classList.add("hidden"); deferredPrompt?.prompt(); deferredPrompt = null; });

  /* Service worker */
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => { navigator.serviceWorker.register("service-worker.js").catch(()=>{}); });
  }
</script>
</body>
</html>